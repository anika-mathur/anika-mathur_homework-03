Homework 3

name : \[Anika Mathur\]

repository : \[[anika-mathur_homework-03](https://github.com/anika-mathur/anika-mathur_homework-03)\]

setup

```{r}
# general use
library(tidyverse)
library(readxl)
library(here)
library(janitor)

# visualizing pairs
library(GGally)

# model selection
library(MuMIn)

# model predictions
library(ggeffects)

# model tables
library(gtsummary)
library(flextable)
library(modelsummary)
library(ggplot2)
library(kableExtra)
library(broom)
library(dplyr)

drought_exp <- read_xlsx(path = here("data", 
                                     "Valliere_etal_EcoApps_Data.xlsx"),
                         sheet = "First Harvest")

# quick look at data 
str(drought_exp)
class(drought_exp)
```

cleaning

```{r}
# cleaning
drought_exp_clean <- drought_exp %>% 
  clean_names() %>% # nicer column names
  mutate(species_name = case_when( # adding column with species scientific names
    species == "ENCCAL" ~ "Encelia californica", # bush sunflower
    species == "ESCCAL" ~ "Eschscholzia californica", # California poppy
    species == "PENCEN" ~ "Penstemon centranthifolius", # Scarlet bugler
    species == "GRICAM" ~ "Grindelia camporum", # great valley gumweed
    species == "SALLEU" ~ "Salvia leucophylla", # Purple sage
    species == "STIPUL" ~ "Nasella pulchra", # Purple needlegrass
    species == "LOTSCO" ~ "Acmispon glaber" # deerweed
  )) %>% 
  relocate(species_name, .after = species) %>% # moving species_name column after species
  mutate(water_treatment = case_when( # adding column with full treatment names
    water == "WW" ~ "Well watered",
    water == "DS" ~ "Drought stressed"
  )) %>% 
  relocate(water_treatment, .after = water) # moving water_treatment column after water
```

visualizing

correlations

```{r}
ggpairs(drought_exp_clean, # data frame
        columns = c("leaf_dry_weight_g", # columns to visualize
                    "sla", 
                    "shoot_g", 
                    "root_g", 
                    "total_g"), 
        upper = list(method = "pearson")) + # calculating Pearson correlation coefficient
  theme_bw() + # cleaner theme
  theme(panel.grid = element_blank()) # getting rid of gridlines
```

biomass between species

```{r}
ggplot(data = drought_exp_clean, # data frame
       aes(x = reorder(species_name, # reordering x-axis
                       -total_g, # in reverse order of mean total mass
                       fun = mean), # calculating mean to reorder
           y = total_g)) + # y-axis
  geom_jitter(width = 0.1, # narrow jitter
              height = 0) # not jittering points up and down
```

total biomass difference between water treatments

```{r}
ggplot(data = drought_exp_clean, # data frame
       aes(x = water_treatment, # x-axis
           y = total_g)) + # y-axis
  geom_jitter(width = 0.1, # narrow jitter
              height = 0) # not jittering points up and down
```

SLA influence on biomass

```{r}
ggplot(data = drought_exp_clean, # data frame
       aes(x = sla, # x-axis
           y = total_g)) + # y-axis
  geom_point() # scatterplot
```

null model

```{r}
model0 <- lm(total_g ~ 1, # formula
             data = drought_exp_clean) # data frame
```

total biomass as a function of SLA, water treatment, and species

```{r}
# saturated model
model1 <- lm(total_g ~ sla + water_treatment + species_name,
             data = drought_exp_clean)

par(mfrow = c(2, 2))
plot(model1)
```

total biomass as a function of SLA and water treatment

```{r}
model2 <- lm(total_g ~ sla + water_treatment,
             data = drought_exp_clean)

plot(model2)
```

total biomass as a function of SLA and species

```{r}
model3 <- lm(total_g ~ sla + species_name,
             data = drought_exp_clean)

plot(model3)
```

total biomass as a function of water treatment and species

```{r}
model4 <- lm(total_g ~ water_treatment + species_name,
             data = drought_exp_clean)

plot(model4)
```

model selection

```{r}
model.sel(model0,
          model1, 
          model2, 
          model3,
          model4)
```

Problem 1

1a.

Total biomass and its predictors

| Model    | Predictors                                            |
|----------|-------------------------------------------------------|
| 0 (null) | n/a                                                   |
| 1        | SLA(specific leaf area), water treatment, and species |
| 2        | SLA and water treatment                               |
| 3        | SLA and species                                       |
| 4        | water treatment and species                           |

1b.

1c.

```{r}
# model predictions and the confidence intervals
predictions <- predict(model4, newdata = drought_exp_clean, interval = "confidence")

drought_exp_clean$predicted <- predictions[,1]
drought_exp_clean$conf.low <- predictions[,2]
drought_exp_clean$conf.high <- predictions[,3]

# make a plot
p <- ggplot(data = drought_exp_clean, aes(x = species_name, y = total_g, color = water_treatment)) +
  
  geom_point(position = position_jitter(height = 0.1), alpha = 0.5, size = 2) + 
  
  # confidence intervals and prediction lines
  geom_line(aes(y = predicted), size = 1) +  # Prediction line
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high, fill = water_treatment), alpha = 0.3) +  
  
  # theme
  theme_classic() +
  
 
  facet_wrap(~ species_name, scales = "free_x") +
  
  # water treatment 
  scale_color_manual(values = c("Well watered" = "#1f78b4", "Drought stressed" = "#e31a1c")) +
  scale_fill_manual(values = c("Well watered" = "#1f78b4", "Drought stressed" = "#e31a1c")) +
  
  # add axis titles
  labs(x = "Species Name",
       y = "Total Biomass (g)",
       title = "Model Predictions and Underlying Data",
       subtitle = "Colored by Water Treatment")

print(p)
```
